<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Programming and Computing Group">
    <title>Using python for scripting</title>
    <meta name="author" content="PnCG" />
    <link rel="stylesheet" href="/stylesheets/styles.css">
 <style>
      header { zoom: 1.0; width: 150px}
      header h1 { margin-bottom: 5px; }
      header h1 a { color: #494949; font-weight: bold; }
      header h3 { margin-top: 20px; margin-bottom: 5px; }
      header p.view { margin-bottom: 5px; }
      header p.view small { padding-top: 2px; }
      header ul {
        zoom: 0.7;
        margin-top: 25px;
      }
      section { width: 600px }
      section p { margin-top: 10px; }
      section h1 { margin-bottom: 15px; }
      section h2 { margin-bottom: 10px; }
      section h2 { margin-bottom: 10px; }
      footer { bottom: 20px; }
      footer p { margin-bottom: 5px; }
      .half-width {
        float: left;
        width: 100px;
        list-style: none;
        padding: 5px;
        margin: 7px;
        margin-bottom: 10px;
      }
      .half-width h4 {
        margin-bottom: 5px;
      }
      .half-width ul {
        padding-left: 0;
      }
      .half-width ul li {
        list-style: inside;
        font-size: 15px;
      }
      .clear-fix {
        clear: both;
      }
    </style>
    <script src="https://github.com/themes/minimal/javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
</head>

<body>
    <div class="wrapper">
        <header>
        <h1><a href="/">PnCG</a></h1>
        

        ---
layout: default
title: Some projects
---

# Open Source Projects

###  Python Tutorial
[Python-Tutorial](http://pncg.github.io/Python_Tutorial) is an ongoing work. Its
community effort.


        </header>
        <footer>
        </footer>

    <section id="post">
    <h1>Using python for scripting </h1>
<h5> by Dilawar Singh, 13 February 2014 </h5>
<div class="content">
  <p>I am one of those who prefer bash over anything else for system scripting. Bash
is minimal and I love this about it. In bash, one deals with only text although
some primitive data-structures such as arrays are also available. Bash is one of
those things which proves that so much can be accomplished by a minimal tool.
But scripting is more than just managing and administering systems.</p>

<p>Python scripts are easy to maintain and write. They are easy because Python
comes with extensive standard library. It has great great support for reading
and parsing text files, easy to use data-structures and iterators. Moreover, a
huge user community has created a great deal of work which can be easily
plugged. I am pretty sure that Perl (given its age and usage) will also be a
great candidate.</p>

<p>This much is to motivate. Let's see some code so we can do at least one or two
things after reading it. But first thing first.</p>

<h2>Configure editor</h2>

<ul>
<li>Replace tab character in your editor with 4 spaces.</li>
<li>If you can break a line at column-width 80, do it. Don't ask why! Never make a
line bigger than 100 characters.</li>
<li>If you are not into vim or emacs, checkout kate, gedit, notepad++ etc.</li>
</ul>


<p>Check out the <a href="http://legacy.python.org/dev/peps/pep-0008/">most preferred
coding-style</a> in your language of
choice.  Readability of your code matters, whether it is your team-mates or poor
TAs checking your code.  Scripts are no exception even if you are the only one
using it. Good coding style also compensates for the lack of comments.</p>

<h2>Writing a standalone script</h2>

<p>One can write a single script containing everything or break it into many
scripts. The latter is always recommended if your script is larger than few
hundreds of lines. But if you want to write a portable script which you can pass
around, writing a single scripts is not a such a bad idea. But your function
should not be big. If it is more than 50 lines of code, break it into two
functions.</p>

<p>Notice the first line (shebangs/hashbangs) in these scripts. Prefer <code>#!/usr/bin/env</code>
over something like <code>#!/usr/bin/python</code>.</p>

<pre><code>#!/usr/bin/env python
'''
This script can turn water into milk.
'''
def turnWaterIntoMilk():
    print("I dont know how to do it, yet!")
    return None

turnWaterIntoMilk()
</code></pre>

<p>Do not forget to add <a href="http://stackoverflow.com/questions/419163/what-does-if-name-main-do"><code>if __name__ == "__main__"</code></a>
to your script file.</p>

<p>This is how a minimal script should look like.</p>

<pre><code>#!/usr/bin/env python
'''
This script can turn water into milk.
'''
def turnWaterIntoMilk():
    print("I dont know how to do it, yet!")
    return None

if __name__ == "__main__":
    turnWaterIntoMilk()
</code></pre>

<h2>Prefer <code>try/catch</code></h2>

<p><a href="http://programmers.stackexchange.com/questions/175655/python-forgiveness-vs-permission-and-duck-typing">Beg forgiveness over asking permission.</a>
Compare this programming style with <a href="http://docs.python.org/2/glossary.html">Look Before You Leap</a>.</p>

<h2>Working with text files</h2>

<p>To read (write) a file, prefer <code>with</code> statement.</p>

<pre><code>with open("filename.txt", "r") as f:
    txt = f.read()
doSomething(txt)
</code></pre>

<p>Doing this is not also not a bad idea.</p>

<pre><code>txt = open("filename.txt", "r").read()
doSomething(txt)
</code></pre>

<p>The keyword <code>with</code> takes care of closing the file once everything is read or
written to the file. If you want to read line by line in a file, this is handy.</p>

<pre><code>with open("filename.txt", "r") as f:
    for line in f:
        doSomethingWithLine(line)
</code></pre>

<p>Or, with a little bit of functional style makes things smaller. I just love list
comprehension.</p>

<pre><code>with open("filename.txt", "r") as f:
    [ doSomethingWithLine(line) for line in f ]
</code></pre>

<h2>Manipulating string</h2>

<p>Once a text-file is read, one process it contents. Some of the more basic
operations on strings are listed below.</p>

<h4>Break a string at a substring</h4>

<pre><code>line = "Happiness can't buy me money"
tokens = line.split()
print tokens
</code></pre>

<p>This will print <code>['Happiness', "can't", 'buy', 'me', 'money']</code>. If function
<code>split</code> is given a substring, the string will be broken at given substring.</p>

<pre><code>token = line.split("ne")
</code></pre>

<p>This gives <code>['Happi', "ss can't buy me mo", 'y']</code>. Notice that substring is
removed. If substring is not found, it does the obvious. Try it!</p>

<p>More complex string manipulation can be done using regular expressions. They are
powerful tools and it is very easy to write very inefficient regular
expressions. It would be a good project to write a function which minimizes a
giver regular expressions (state minimization in state-machine).</p>

<h4>Replacing substring</h4>

<p>Say you want to replace all 'ness' with 'less' in a string.</p>

<pre><code>newLine = line.replace('ness', 'less')
</code></pre>

<p><code>newLine</code> is now <code>"Happiless can't buy me money"</code>. One can even chains these
operations.</p>

<pre><code class="">newLine = line.replace('p', 't').replace('e', 'o') 
</code></pre>

<p><code>newLine</code> is <code>Hattinoss can't buy mo monoy</code>. Actually
<a href="http://docs.python.org/2/library/stdtypes.html#str.translate"><code>str.translate</code></a>
is a much better way to do this though harder to remember.</p>

<h2>Call system command using <code>subprocess</code></h2>

<p>Let's take an example: use <code>pandoc</code> to convert a markown to html. The shell
command is following.</p>

<pre><code>pandoc -f markdown -t html file.markdown &gt; file.html
</code></pre>

<p>Equivalent in Python using <code>subprocess</code>  is following. One can also some
shorter version of this command. I prefer this because I get much finer control
over the system command.</p>

<p>This is a rather involved example. Mostly one runs a command and captures its
output and decide what to do next depending on the output.</p>

<pre><code>with open("file.markdown", "r" as f:
    markdown = f.read()

cmd = ["pandoc", "-f", "markdown", "-t", "html"]
p = subprocess.Popen(cmd
        , stdin = subprocess.PIPE
        , stdout = subprocess.PIPE
        )
# Write mardown content into stdin
p.stdin.write(markdown)
# Recieve html from stdout
html = p.communicate()[0]
</code></pre>

<h2>Regular expressions</h2>

<p>I don't know why I am touching it.</p>

<p>Regular expression are like language grammar (perhaps less powerful): they
accept or reject a given string. This is very useful for making sense out of
user input or commands. They can also be used for simple parsing. You can read
about it <a href="http://en.wikibooks.org/wiki/Regular_Expressions/Introduction">here</a>.
Understanding regex needs some reading and getting it work in any language is
not always easy. If one can debug a wrong regex, one can debug almost anything.</p>

<p>I want to show it in action. If it does not make sense at all, then do read
about it.</p>

<p>Suppose a user gives me a line suppose to be a valid voltage source line from a
spice script. The grammar (roughly) is following (case insensitive).</p>

<blockquote><p>v by name of device e.g. V1, va, vn1 etc. This is followed by
name of its terminals  and then its type (ac or dc). This is followed by its
value in decimal (ignore 1e-5 syntax for now). Immediately after the value there
is a character: k for kilo, m or mili, M or mega etc. For example.</p></blockquote>

<pre><code>line = "v1 in1 out1 dc 0.1k"
</code></pre>

<p>Following regular expression accepts a valid string of above grammar and rejects
bad one.</p>

<pre><code>import re
pat = re.compile(r'v(?P&lt;name&gt;\w+)\s+(?P&lt;in&gt;\w+)\s+(?P&lt;out&gt;\w+)\s+(?P&lt;type&gt;ac|dc)\s+(?P&lt;value&gt;\d+(\.\d+)?)\w', re.I)
m = pat.match(line)
if m:
    print("This matches. Matched values are")
    print(m.groupdict())
else:
    print("Given line is not a valid spice line for volatage source")
    raise UserWarning("Bad input")
</code></pre>

<p>This prints</p>

<pre><code>This matches. Matched values are
{u'in': u'in1', u'type': u'dc', u'name': u'1', u'value': u'0.1', u'out': u'out1'}
</code></pre>

<p>Well, since we are here let's make some sense out of regex. Let's remove
'?P<someting>' from the regex, it is used to name a subsection of regex so we
can access it later. The regex is now
<code>v(\w+)\s+(\w+)\s+(\w+)\s+(ac|dc)\s+(\d+(\.\d+)?)\w'</code>.  Symbol <code>\w</code> means 'a
alphanumeric character or the underscore' <code>+</code> means one or more time i.e. <code>\w+</code>
means 'a alphanumeric character or the underscore, one or more times. Therefore
<code>v\w+</code> means character <code>v</code> followed by one or more alphanumeric character or
underscore. Next we have <code>\s+</code> which is one or more whitespaces etc. (ac|dc)
means either string <code>ac</code> or <code>dc</code>. <code>\d</code> means a number. <code>(\.\d+)</code> means a literal
<code>.</code> followed by one or more number e.g. <code>.99</code>, <code>.001</code> but it is postfixed by <code>?</code>
which make it <em>optional</em>. In nutshell if it can match <code>1.22</code> as well as <code>1</code> (.22
is optional). Phew!</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li> <a href="/notes/information/2014/07/01/Programming-Languages-and-why-python/">A note on programming languages, Ease Vs Speed</a></li>
    
  </ul>
</div>

<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

<!-- Google analytic -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47774588-1', 'dilawar.github.io');
    ga('send', 'pageview');
</script>

<div id="comment">



  <div id="disqus_thread"></div>
      <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE *
 * */
      var disqus_shortname = 'pncg'; // required: replace example with
      your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
       var dsq = document.createElement('script');
       dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })();
       </script>

      <noscript>Please enable JavaScript to view the <a
      href="http://disqus.com/?ref_noscript">comments powered by
      Disqus.</a></noscript>

      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



</div>



    </section>

    <!-- Latex in post -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Google analytic -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-47774588-1', 'dilawar.github.io');
        ga('send', 'pageview');
    </script>
</body>
</html>
